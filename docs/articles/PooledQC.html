<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pooled QC analysis • enviGCMS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pooled QC analysis">
<meta property="og:description" content="enviGCMS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58201304-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58201304-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">enviGCMS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GCMSDA.html">Data analysis of GC-MS and LC-MS in Envrionmental Science</a>
    </li>
    <li>
      <a href="../articles/PooledQC.html">Pooled QC analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/yufree/enviGCMS/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PooledQC_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Pooled QC analysis</h1>
                        <h4 class="author">Miao Yu</h4>
            
            <h4 class="date">2020-12-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/yufree/enviGCMS/blob/master/vignettes/PooledQC.Rmd"><code>vignettes/PooledQC.Rmd</code></a></small>
      <div class="hidden name"><code>PooledQC.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yufree/enviGCMS">enviGCMS</a></span><span class="op">)</span></code></pre></div>
<p>Pooled QC samples within injection sequences are very important to control the quality of untargeted analysis. I added some functions in <code>enviGCMS</code> package to visualize or analysis Pooled QC samples or other untargeted peaks profile.</p>
<div id="peaks-profile" class="section level2">
<h2 class="hasAnchor">
<a href="#peaks-profile" class="anchor"></a>Peaks profile</h2>
<p>We could check sample-wise changes of peaks.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotpeak.html">plotpeak</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>, lv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Or peak-wise changes of samples.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotpeak.html">plotpeak</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="density-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#density-distribution" class="anchor"></a>Density distribution</h2>
<p>For each sample, the peaks’ density distribution will tell us if certain samples show large shift.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotden.html">plotden</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span>,ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 1-d density for multiple samples</span>
<span class="fu"><a href="../reference/plotrug.html">plotrug</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>, lv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
</div>
<div id="relative-log-abundance-rla-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#relative-log-abundance-rla-plots" class="anchor"></a>Relative Log Abundance (RLA) plots</h2>
<p>Relative Log Abundance (RLA) plots could be another way to show the intensity shift.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotrla.html">plotrla</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="relative-log-abundance-ridge-rlar-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#relative-log-abundance-ridge-rlar-plots" class="anchor"></a>Relative Log Abundance Ridge (RLAR) plots</h2>
<p>Relative Log Abundance Ridge (RLAR) plots could also be used to show the intensity shift.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotridges.html">plotridges</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ridgeline density plot</span>
<span class="fu"><a href="../reference/plotridge.html">plotridge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>,indexy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,xlab <span class="op">=</span> <span class="st">'Intensity'</span>,ylab <span class="op">=</span> <span class="st">'peaks'</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotridge.html">plotridge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span>,xlab <span class="op">=</span> <span class="st">'Intensity'</span>,ylab <span class="op">=</span> <span class="st">'peaks'</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-3.png" width="700"></p>
</div>
<div id="density-weighted-total-usable-signal" class="section level2">
<h2 class="hasAnchor">
<a href="#density-weighted-total-usable-signal" class="anchor"></a>Density Weighted Total Usable Signal</h2>
<p>The sum of all peaks’ intensity or total usable signal(TUS) could show the general trends for each sample while peaks with lower ionization energy will dominated such value. Here I introduced a density weighted TUS to make the values robust to low frequency high intensity peaks. You could use <code>getdwtus</code> to calculate DWTUS for samples.</p>
<p><span class="math display">\[DWTUS = \sum peak\ intensity * peak\ density\]</span></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="fl">2</span>,<span class="va">getdwtus</span><span class="op">)</span>
<span class="co">#&gt;     ko15     ko16     ko18     ko19     ko21     ko22     wt15     wt16 </span>
<span class="co">#&gt; 27.63040 29.95684 29.47828 28.80768 28.55539 29.62787 26.01125 26.66868 </span>
<span class="co">#&gt;     wt18     wt19     wt21     wt22 </span>
<span class="co">#&gt; 25.42983 27.04065 26.67595 31.46668</span>
<span class="fu"><a href="../reference/plotdwtus.html">plotdwtus</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="run-order-effect-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#run-order-effect-analysis" class="anchor"></a>Run order effect analysis</h2>
<p>For LC/GC-MS analysis, the run order will affect the intensity of single peak until the instrument is stable. The intensity will decrease/increase with initial run order and researcher need to evaluate how many samples are enough to eliminated run order effects. Here I introduced a pooled QC linear index to show such trends in the sequence.</p>
<div class="figure">
<img src="https://yufree.github.io/presentation/figure/pooledQC.png" alt=""><p class="caption">pqsi</p>
</div>
<p>As shown in above figure, for one peak repeated analyzed in one sequence, the intensity would become stable in long term. In math, the slope of every 5 samples along the run order would become 0. Then we could define the percentage of stable peaks as pooled QC index. Such index would be a value between 0 and 1. The higher of such index, more peaks within the QC would be affected by run order effect. You could use such function to check the QC samples to see if run order effects would influence the samples at the beginning of sequences.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">order</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>
<span class="co"># n means how many points to build a linear regression model</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getpqsi.html">getpqsi</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="va">order</span>,n <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">idx</span><span class="op">~</span><span class="va">order</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>In this case, we could see at 5th sample, 30% peaks show correlation with the run order. However, ever since 6th sample, the run order effects could be ignore.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Miao YU.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
