<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pooled QC analysis • enviGCMS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pooled QC analysis">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58201304-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58201304-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">enviGCMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GCMSDA.html">Data analysis of GC-MS and LC-MS in Environmental Science</a></li>
    <li><a class="dropdown-item" href="../articles/PooledQC.html">Pooled QC analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yufree/enviGCMS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Pooled QC analysis</h1>
                        <h4 data-toc-skip class="author">Miao Yu</h4>
            
            <h4 data-toc-skip class="date">2025-01-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/yufree/enviGCMS/blob/HEAD/vignettes/PooledQC.Rmd" class="external-link"><code>vignettes/PooledQC.Rmd</code></a></small>
      <div class="d-none name"><code>PooledQC.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yufree.github.io/enviGCMS/">enviGCMS</a></span><span class="op">)</span></span></code></pre></div>
<p>Pooled QC samples within injection sequences are very important to
control the quality of untargeted analysis. I added some functions in
<code>enviGCMS</code> package to visualize or analysis Pooled QC samples
or other untargeted peaks profile.</p>
<div class="section level2">
<h2 id="peaks-profile">Peaks profile<a class="anchor" aria-label="anchor" href="#peaks-profile"></a>
</h2>
<p>We could check sample-wise changes of peaks.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotpeak.html">plotpeak</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>, lv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Or peak-wise changes of samples.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotpeak.html">plotpeak</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="density-distribution">Density distribution<a class="anchor" aria-label="anchor" href="#density-distribution"></a>
</h2>
<p>For each sample, the peaks’ density distribution will tell us if
certain samples show large shift.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotden.html">plotden</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span>,ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1-d density for multiple samples</span></span>
<span><span class="fu"><a href="../reference/plotrug.html">plotrug</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>, lv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="relative-log-abundance-rla-plots">Relative Log Abundance (RLA) plots<a class="anchor" aria-label="anchor" href="#relative-log-abundance-rla-plots"></a>
</h2>
<p>Relative Log Abundance (RLA) plots could be another way to show the
intensity shift.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotrla.html">plotrla</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="relative-log-abundance-ridge-rlar-plots">Relative Log Abundance Ridge (RLAR) plots<a class="anchor" aria-label="anchor" href="#relative-log-abundance-ridge-rlar-plots"></a>
</h2>
<p>Relative Log Abundance Ridge (RLAR) plots could also be used to show
the intensity shift.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotridges.html">plotridges</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ridgeline density plot</span></span>
<span><span class="fu"><a href="../reference/plotridge.html">plotridge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>,indexy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,xlab <span class="op">=</span> <span class="st">'Intensity'</span>,ylab <span class="op">=</span> <span class="st">'peaks'</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotridge.html">plotridge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">group</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span>,xlab <span class="op">=</span> <span class="st">'Intensity'</span>,ylab <span class="op">=</span> <span class="st">'peaks'</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-6-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="density-weighted-total-usable-signal">Density Weighted Total Usable Signal<a class="anchor" aria-label="anchor" href="#density-weighted-total-usable-signal"></a>
</h2>
<p>The sum of all peaks’ intensity or total usable signal(TUS) could
show the general trends for each sample while peaks with lower
ionization energy will dominated such value. Here I introduced a density
weighted TUS to make the values robust to low frequency high intensity
peaks. You could use <code>getdwtus</code> to calculate DWTUS for
samples.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>W</mi><mi>T</mi><mi>U</mi><mi>S</mi><mo>=</mo><mo>∑</mo><mi>p</mi><mi>e</mi><mi>a</mi><mi>k</mi><mspace width="0.222em"></mspace><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>*</mo><mi>p</mi><mi>e</mi><mi>a</mi><mi>k</mi><mspace width="0.222em"></mspace><mi>d</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">DWTUS = \sum peak\ intensity * peak\ density</annotation></semantics></math></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="fl">2</span>,<span class="va">getdwtus</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ko15     ko16     ko18     ko19     ko21     ko22     wt15     wt16 </span></span>
<span><span class="co">#&gt; 27.60340 29.92758 29.44948 28.77953 28.52748 29.59891 25.98583 26.64262 </span></span>
<span><span class="co">#&gt;     wt18     wt19     wt21     wt22 </span></span>
<span><span class="co">#&gt; 25.40499 27.01423 26.64988 31.43594</span></span>
<span><span class="fu"><a href="../reference/plotdwtus.html">plotdwtus</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="run-order-effect-analysis">Run order effect analysis<a class="anchor" aria-label="anchor" href="#run-order-effect-analysis"></a>
</h2>
<p>For LC/GC-MS analysis, the run order will affect the intensity of
single peak until the instrument is stable. The intensity will
decrease/increase with initial run order and researcher need to evaluate
how many samples are enough to eliminated run order effects. Here I
introduced a pooled QC linear index to show such trends in the
sequence.</p>
<div class="float">
<img src="https://yufree.github.io/presentation/figure/pooledQC.png" alt="pqsi"><div class="figcaption">pqsi</div>
</div>
<p>As shown in above figure, for one peak repeated analyzed in one
sequence, the intensity would become stable in long term. In math, the
slope of every 5 samples along the run order would become 0. Then we
could define the percentage of stable peaks as pooled QC index. Such
index would be a value between 0 and 1. The higher of such index, more
peaks within the QC would be affected by run order effect. You could use
such function to check the QC samples to see if run order effects would
influence the samples at the beginning of sequences.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span></span>
<span><span class="co"># n means how many points to build a linear regression model</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getpqsi.html">getpqsi</a></span><span class="op">(</span><span class="va">list</span><span class="op">$</span><span class="va">data</span>,<span class="va">order</span>,n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">idx</span><span class="op">~</span><span class="va">order</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="PooledQC_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>In this case, we could see at 5th sample, 30% peaks show correlation
with the run order. However, ever since 6th sample, the run order
effects could be ignore.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miao YU.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
